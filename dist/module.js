/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","react"],((e,t,r,n,o)=>(()=>{"use strict";var a=[e=>{e.exports=n},e=>{e.exports=o},e=>{e.exports=r},t=>{t.exports=e},,e=>{e.exports=t}],i={};function c(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return a[e](r,r.exports,c),r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{c.r(u),c.d(u,{plugin:()=>ye});var e=c(3),t=c(0),r=c(5);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}var o=function(e){return"request=".concat(JSON.stringify(e))};function a(e,t,r){return o({specification:i(e,t),data_range:{time_range:r}})}function i(e,t){if("RAW"===e)return o=(r=t).params,a=r.context,i=("metric"===o.graphMode?"METRIC_":"")+o.graph_name,["template",n({},l(a||{}),{graph_id:i})];if("CEE"===e)return function(e){var t=e.params,r=e.context,o=("metric"===t.graphMode?"METRIC_":"")+t.graph_name;return["combined",n({},s(r||{}),{graph_template:o,presentation:t.presentation})]}(t);var r,o,a,i;throw new Error("UNSUPORTED EDITION")}function l(e){return{site:(0,t.get)(e,"siteopt.site",""),host_name:(0,t.get)(e,"host.host",""),service_description:(0,t.get)(e,"service.service","")}}function s(e){return{context:e,datasource:"services",single_infos:["host"]}}var f={params:{graphMode:"template",presentation:"lines"},context:{}};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h.apply(this,arguments)}function d(){d=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new S(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return k()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=E(i,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,i),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function f(){}function h(){}function v(){}var y={};c(y,o,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(j([])));g&&g!==t&&r.call(g,o)&&(y=g);var b=v.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,i,c){var u=l(e[o],e,a);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==p(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(f).then((function(e){s.value=e,i(s)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function E(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function j(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:k}}function k(){return{value:void 0,done:!0}}return h.prototype=v,c(b,"constructor",v),c(v,"constructor",h),h.displayName=c(v,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,i,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new x(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),c(b,i,"Generator"),c(b,o,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=j,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,s):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}function v(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function y(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){v(a,n,o,i,c,"next",e)}function c(e){v(a,n,o,i,c,"throw",e)}i(void 0)}))}}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=x(e);if(t){var o=x(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return w(this,r)}}function w(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function E(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O(r,n){if(0!==r.data.result_code)throw new Error("".concat(r.data.result));var o=r.data.result,a=o.start_time,i=o.step,c=o.curves,u=new e.MutableDataFrame({refId:n.refId,fields:[{name:"Time",type:e.FieldType.time}].concat(c.map((function(t){return{name:t.title,type:e.FieldType.number}})))});return t.zip.apply(void 0,E(c.map((function(e){return e.rrddata})))).forEach((function(e,t){return u.appendRow([1e3*(a+t*i)].concat(E(e)))})),u}var S=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(S,n);var i,c,u,l,p,v,w,x,E,_=b(S);function S(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S),(t=_.call(this,e)).instanceSettings=e,t.instanceSettings=e,t}return i=S,c=[{key:"query",value:(E=y(d().mark((function e(r){var n,o,a,i,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.range,o=n.from.unix(),a=n.to.unix(),i=this,c=r.targets.map((function(e){var r=(0,t.defaults)(e,f);return i.getGraphQuery([o,a],r)})),e.abrupt("return",Promise.all(c).then((function(e){return{data:e}})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"getGraphQuery",value:(x=y(d().mark((function r(n,o){var i,c;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(0,t.isEmpty)(o.context)&&o.params.graph_name){r.next=2;break}return r.abrupt("return",new e.MutableDataFrame);case 2:return i=(0,t.get)(this,"instanceSettings.jsonData.edition","CEE"),r.next=5,this.doRequest(h({},o,{params:{action:"get_graph"},data:a(i,o,n)}));case 5:return c=r.sent,r.abrupt("return",O(c,o));case 7:case"end":return r.stop()}}),r,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"testDatasource",value:(w=y(d().mark((function e(){var t=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doRequest({refId:"testDatasource",params:{action:"get_combined_graph_identifications"},data:o(s({host:{host:"ARANDOMNAME"}})),context:{}}).catch((function(e){var r;if("Checkmk exception: Currently not supported with this Checkmk Edition"!==e.message.split("\n")[0])throw e;if("CEE"===(null!==(r=t.instanceSettings.jsonData.edition)&&void 0!==r?r:"CEE"))throw new Error("Mismatch between selected Checkmk edition and monitoring site edition")})).then((function(e){return{status:"success",message:"Data source is working",title:"Success"}})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"doRequest",value:(v=y(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cmkRequest({method:null==t.data?"GET":"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:(r="".concat(this.instanceSettings.url,"/cmk/check_mk/webapi.py"),n=t.params,r+"?"+new URLSearchParams(n).toString()),data:t.data}));case 1:case"end":return e.stop()}var r,n}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"restRequest",value:(p=y(d().mark((function e(t,r){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cmkRequest({method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"".concat(this.instanceSettings.url,"/cmk/check_mk/").concat(t),data:o(r)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"cmkRequest",value:(l=y(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.getBackendSrv)().datasourceRequest(t).catch((function(e){throw e.cancelled?new Error("API request was cancelled. This has either happened because no 'Access-Control-Allow-Origin' header is present, or because of a ssl protocol error. Make sure you are running at least Checkmk version 2.0."):new Error("Could not read API response, make sure the URL you provided is correct.")}));case 2:if("string"!=typeof(n=e.sent).data){e.next=7;break}throw new Error("".concat(n.data));case 7:if(0===n.data.result_code){e.next=11;break}throw new Error("".concat(n.data.result));case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})}],c&&m(i.prototype,c),u&&m(i,u),Object.defineProperty(i,"prototype",{writable:!1}),S}(e.DataSourceApi),j=c(1),k=c.n(j),C=c(2);function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},L.apply(this,arguments)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=D(e);if(t){var o=D(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return A(this,r)}}function A(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var G=C.LegacyForms.SecretFormField,W=C.LegacyForms.FormField,M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(a,e);var t,r,n,o=I(a);function a(){var e;F(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return N(T(e=o.call.apply(o,[this].concat(r))),"onUrlChange",(function(t){var r=e.props,n=r.onOptionsChange,o=r.options,a=L({},o.jsonData,{url:t.target.value});n(L({},o,{jsonData:a}))})),N(T(e),"onEditionChange",(function(t){var r=t.value,n=e.props,o=n.onOptionsChange,a=n.options,i=L({},a.jsonData,{edition:r});o(L({},a,{jsonData:i}))})),N(T(e),"onUsernameChange",(function(t){var r=e.props,n=r.onOptionsChange,o=r.options,a=L({},o.jsonData,{username:t.target.value});n(L({},o,{jsonData:a}))})),N(T(e),"onSecretChange",(function(t){var r=e.props;(0,r.onOptionsChange)(L({},r.options,{secureJsonData:{secret:t.target.value}}))})),N(T(e),"onResetSecret",(function(){var t=e.props,r=t.onOptionsChange,n=t.options;r(L({},n,{secureJsonFields:L({},n.secureJsonFields,{secret:!1}),secureJsonData:L({},n.secureJsonData,{secret:""})}))})),e}return t=a,(r=[{key:"render",value:function(){var e=this.props.options,t=e.jsonData,r=e.secureJsonFields,n=e.secureJsonData||{},o=[{value:"CEE",label:"Enterprise Editions"},{value:"RAW",label:"RAW Edition"}];return t.edition||this.onEditionChange(o[0]),k().createElement(k().Fragment,null,k().createElement(C.FieldSet,{label:"Monitoring Site"},k().createElement("div",{className:"gf-form"},k().createElement(W,{label:"URL",labelWidth:6,inputWidth:20,onChange:this.onUrlChange,value:t.url||"",tooltip:"Which Checkmk Server to connect to. (Example: https://checkmk.server/site)"})),k().createElement(C.InlineField,{label:"Edition",labelWidth:12},k().createElement(C.Select,{width:32,options:o,onChange:this.onEditionChange,value:t.edition,placeholder:"Select your checkmk edition"}))),k().createElement(C.FieldSet,{label:"Authentication"},k().createElement("div",{className:"gf-form"},k().createElement(W,{label:"Username",labelWidth:6,inputWidth:20,onChange:this.onUsernameChange,value:t.username||"",tooltip:"A checkmk monitoring user. Don't use 'automation' user, because it has admin rights."})),k().createElement("div",{className:"gf-form"},k().createElement(G,{isConfigured:r&&r.secret,value:n.secret||"",label:"Secret",placeholder:"",labelWidth:6,inputWidth:20,onReset:this.onResetSecret,onChange:this.onSecretChange,tooltip:"You can find the secret for your user in your checkmk server under Users."}))))}}])&&q(t.prototype,r),n&&q(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(j.PureComponent);function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,a=[],i=!0,c=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(c)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},J.apply(this,arguments)}var Q=function(e,r,n){var o=(0,t.cloneDeep)(e);return(0,t.update)(o,r,n),o},B=function(e,t){return function(r){return e.restRequest("ajax_vs_autocomplete.py",J({},t,{value:r.trim()})).then((function(e){return e.data.result.choices.map((function(e){var t=U(e,2),r=t[0];return{value:r,label:t[1],isDisabled:null===r}}))}))}},Y=function(e){var r=e.autocompleter,n=e.onChange,o=e.onRunQuery,a=e.query,i=e.contextPath,c=JSON.stringify(a.context);return"params.graph_name"===i&&(c+=(0,t.get)(a,"params.graphMode")),k().createElement(C.AsyncSelect,{onChange:function(e){var t=Q(a,i,(function(){return e.value}));t=Q(t,"params.selections."+i,(function(){return e})),n(t),o()},loadOptions:r,defaultOptions:!0,key:c,value:(0,t.get)(a,"params.selections."+i,{}),width:32})},z=function(e){var r=e.query,n=e.onChange,o=e.onRunQuery,a=e.contextPath;return k().createElement(C.InlineField,{label:"Graph type",labelWidth:14},k().createElement(C.Select,{width:32,options:[{value:"template",label:"Template"},{value:"metric",label:"Single metric"}],onChange:function(e){n(Q(r,a,(function(){return e.value}))),o()},value:(0,t.get)(r,a,"template")}))},$=function(e){var r=(0,t.get)(e,"query.params.graphMode","template"),n={};"CEE"===e.edition?n={ident:"combined_graphs",params:J({},s(e.query.context),{presentation:e.query.params.presentation,mode:r})}:"RAW"===e.edition&&(n={ident:"metric"===e.query.params.graphMode?"monitored_metrics":"available_graphs",params:{strict:"withSource",context:(0,t.get)(e,"query.context",{})}});var o,a=(o=r)[0].toUpperCase()+o.slice(1).toLowerCase(),i=B(e.datasource,n);return k().createElement(k().Fragment,null,k().createElement(z,J({contextPath:"params.graphMode"},e,{autocompleter:function(e){return new Promise((function(){return{}}))}})),k().createElement(C.InlineField,{labelWidth:14,label:a},k().createElement(Y,J({autocompleter:function(e){return i(e).then((function(e){return"template"===r?e.filter((function(e){var t=e.value;return t&&!t.startsWith("METRIC_")})):e}))},contextPath:"params.graph_name"},e))))};function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V.apply(this,arguments)}var K=function(e){var t={ident:"sites",params:{strict:!1,context:e.query.context}};return k().createElement(C.InlineField,{labelWidth:14,label:"Site"},k().createElement(Y,V({autocompleter:B(e.datasource,t),contextPath:"context.siteopt.site"},e)))},X=function(e){var t={ident:"monitored_hostname",params:{strict:!0,context:e.query.context}};return k().createElement(C.InlineField,{labelWidth:14,label:"Hostname"},k().createElement(Y,V({autocompleter:B(e.datasource,t),contextPath:"context.host.host"},e)))},Z=function(e){var r=(0,t.get)(e,"query.context.hostregex",{});return k().createElement(C.InlineFieldRow,null,k().createElement(C.InlineField,{label:"Hostname regex",labelWidth:14},k().createElement(C.Input,{width:32,type:"text",value:r.host_regex||"",onChange:function(r){var n=e.onChange,o=e.query;(0,t.update)(o,"context.hostregex.host_regex",(function(){return r.target.value})),n(o)},placeholder:"none"})),k().createElement(C.Checkbox,{label:"negate",onChange:function(r){var n=e.onChange,o=e.query;(0,t.update)(o,"context.hostregex.neg_host_regex",(function(){return r.target.checked?"on":""})),n(o)}}))},ee=function(e){var r={ident:"monitored_service_description",params:{strict:!0,host:(0,t.get)(e,"query.context.host.host",""),context:e.query.context}};return k().createElement(C.InlineField,{labelWidth:14,label:"Service"},k().createElement(Y,V({autocompleter:B(e.datasource,r),contextPath:"context.service.service"},e)))},te=function(e){var r=(0,t.get)(e,"query.context.serviceregex.service_regex","");return k().createElement(C.InlineFieldRow,null,k().createElement(C.InlineField,{label:"Service regex",labelWidth:14},k().createElement(C.Input,{width:32,type:"text",value:r,onChange:function(r){var n=e.onChange,o=e.query;(0,t.update)(o,"context.serviceregex.service_regex",(function(){return r.target.value})),n(o)},placeholder:"none"})),k().createElement(C.Checkbox,{label:"negate",onChange:function(r){var n=e.onChange,o=e.query;(0,t.update)(o,"context.serviceregex.neg_service_regex",(function(){return r.target.checked?"on":""})),n(o)}}))},re=function(e){var r=e.datasource,n=e.onChange,o=e.query,a=e.onRunQuery,i=function(e){return e.map((function(e){var t=e.value;return{label:t,value:t}}))},c=(0,t.get)(o,"context.host_labels.host_label","[]"),u=i(JSON.parse(c));return k().createElement(C.InlineField,{label:"Host labels",labelWidth:14},k().createElement(C.AsyncMultiSelect,{width:32,defaultOptions:!0,loadOptions:function(e){var t=e.trim().toLowerCase();return r.restRequest("ajax_autocomplete_labels.py",{world:"core",search_label:t}).then((function(e){return e.data.result.filter((function(e){return e.value.toLowerCase().includes(t)}))})).then(i)},onChange:function(e){(0,t.update)(o,"context.host_labels.host_label",(function(){return JSON.stringify(e.map((function(e){return{value:e.value}})))})),n(o),a()},value:u,placeholder:"Type to trigger search"}))},ne=function(e){var r={ident:"allgroups",params:{group_type:"host",strict:!0,host:(0,t.get)(e,"query.context.opthostgroup.opthost_group",""),context:e.query.context}};return k().createElement(C.InlineFieldRow,null,k().createElement(C.InlineField,{label:"Host is in Group",labelWidth:14},k().createElement(Y,V({autocompleter:B(e.datasource,r),contextPath:"context.opthostgroup.opthost_group"},e))),k().createElement(C.Checkbox,{label:"negate",onChange:function(r){var n=e.onChange,o=e.query;(0,t.update)(o,"context.opthostgroup.neg_opthost_group",(function(){return r.target.checked?"on":""})),n(o)}}))},oe=function(e){var r={ident:"allgroups",params:{group_type:"service",strict:!0,service:(0,t.get)(e,"query.context.optservicegroup.optservice_group",""),context:e.query.context}};return k().createElement(C.InlineFieldRow,null,k().createElement(C.InlineField,{label:"Service is in Group",labelWidth:14},k().createElement(Y,V({autocompleter:B(e.datasource,r),contextPath:"context.optservicegroup.optservice_group"},e))),k().createElement(C.Checkbox,{label:"negate",onChange:function(r){var n=e.onChange,o=e.query;(0,t.update)(o,"context.optservicegroup.neg_optservice_group",(function(){return r.target.checked?"on":""})),n(o)}}))},ae=function(e){var r=e.index,n={ident:"tag_groups",params:{context:e.query.context}},o={ident:"tag_groups_opt",params:{group_id:(0,t.get)(e,"query.context.host_tags.host_tag_".concat(r,"_grp"),""),context:e.query.context}};return k().createElement(k().Fragment,null,k().createElement(C.VerticalGroup,{spacing:"sm"},k().createElement(C.HorizontalGroup,null,k().createElement(C.Label,null,"Host tag ",r+1,": "),k().createElement(Y,V({autocompleter:B(e.datasource,n),contextPath:"context.host_tags.host_tag_".concat(r,"_grp")},e)),k().createElement(C.Select,{width:8,options:[{value:"is",label:"is"},{value:"isnot",label:"is not"}],onChange:function(n){(0,t.update)(e.query,"context.host_tags.host_tag_".concat(r,"_op"),(function(){return n.value})),e.onChange(e.query),e.onRunQuery()},value:(0,t.get)(e.query,"context.host_tags.host_tag_".concat(r,"_op"))}),k().createElement(Y,V({autocompleter:B(e.datasource,o),contextPath:"context.host_tags.host_tag_".concat(r,"_val")},e)))))},ie=function(e){return k().createElement(k().Fragment,null,Array.from({length:3}).map((function(t,r){return k().createElement(ae,V({key:r,index:r},e))})))};function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function le(){le=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new _(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return S()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=w(i,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,i),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function f(){}function p(){}function h(){}var d={};c(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(O([])));y&&y!==t&&r.call(y,o)&&(d=y);var m=h.prototype=f.prototype=Object.create(d);function g(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(o,a,i,c){var u=l(e[o],e,a);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==ce(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(f).then((function(e){s.value=e,i(s)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function O(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=h,c(m,"constructor",h),c(h,"constructor",p),p.displayName=c(h,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new b(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},g(m),c(m,i,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=O,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,s):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:O(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}function se(){return se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},se.apply(this,arguments)}function fe(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var pe=function(e){var t=function(){var t,r=(t=le().mark((function t(r){var n,o,a,i;return le().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=r.value,o=e.onChange,a=e.query,i=e.onRunQuery,o(se({},a,{params:se({},a.params,{presentation:n})})),i();case 4:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){fe(a,n,o,i,c,"next",e)}function c(e){fe(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}();return k().createElement(C.InlineField,{label:"Aggregation",labelWidth:14},k().createElement(C.Select,{width:32,options:[{value:"lines",label:"Lines"},{value:"sum",label:"Sum"},{value:"average",label:"Average"},{value:"min",label:"Minimum"},{value:"max",label:"Maximum"}],onChange:t,value:e.query.params.presentation,placeholder:"Aggregation"}))},he=function(e){var t=e.query.context||{};return k().createElement(k().Fragment,null,Object.keys(t).map((function(t,r){return k().createElement(de,se({key:"".concat(r,"/").concat(t)},e,{filtername:t}))})),k().createElement(de,se({},e,{filtername:""})))},de=function(e){var t=[{value:"siteopt",label:"Site",render:K},{value:"host",label:"Hostname",render:X},{value:"hostregex",label:"Hostname regex",render:Z},{value:"service",label:"Service",render:ee},{value:"serviceregex",label:"Service regex",render:te},{value:"host_labels",label:"Host Labels",render:re},{value:"opthostgroup",label:"Host is in Group",render:ne},{value:"optservicegroup",label:"Service is in Group",render:oe},{value:"host_tags",label:"HostTags",render:ie}],r=e.query.context||{},n=t.filter((function(t){var n=t.value;return n===e.filtername||!r.hasOwnProperty(n)}));if(!n.length)return null;var o=t.find((function(t){return t.value===e.filtername}));return k().createElement(C.InlineFieldRow,null,k().createElement(C.InlineField,{label:"Filter",labelWidth:8},k().createElement(C.Select,{width:32,options:n,onChange:function(t){var r=t.value,n=e.onChange,o=e.query,a=e.filtername;o.context&&delete o.context[a],r&&n(se({},o,{context:se({},o.context,ue({},r,{}))}))},value:e.filtername||null,placeholder:"Filter"})),o&&k().createElement(k().Fragment,null,k().createElement(C.Button,{icon:"minus",variant:"secondary",onClick:function(){var t=e.onChange,r=e.query,n=e.filtername;r.context&&delete r.context[n],t(r)}}),k().createElement(o.render,e)))};function ve(){return ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ve.apply(this,arguments)}var ye=new e.DataSourcePlugin(S).setConfigEditor(M).setQueryEditor((function(e){(0,t.defaults)(e.query,f);var r=(0,t.get)(e,"datasource.instanceSettings.jsonData.edition","");return k().createElement("div",{className:"gf-form-group"},"RAW"===r&&k().createElement(C.InlineFieldRow,null,k().createElement(K,e),k().createElement(X,e),k().createElement(ee,e),k().createElement($,ve({edition:r},e))),"CEE"===r&&k().createElement(k().Fragment,null,k().createElement(he,e),k().createElement(pe,e),k().createElement($,ve({edition:r},e))))}))})(),u})()));
//# sourceMappingURL=module.js.map